<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>中原大學六十週年校慶</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/flexslider.css" rel="stylesheet" >
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/queries.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
	<!--上面這些link都是這個網頁的css-->
	
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
      </head>
      <body id="top">
        <header id="home">
          <nav>
            <div class="container-fluid">
              <div class="row">
                <div class="col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-8 col-xs-offset-2">
                  <nav class="pull">
                    <ul class="top-nav">
                      <li><a href="#intro">介紹 <span class="indicator"><i class="fa fa-angle-right"></i></span></a></li>
                      <li><a href="#features">選擇場景<span class="indicator"><i class="fa fa-angle-right"></i></span></a></li>
                      <li><a href="#responsive">拍張照吧 <span class="indicator"><i class="fa fa-angle-right"></i></span></a></li>
                      <li><a href="#hero">合成照片 <span class="indicator"><i class="fa fa-angle-right"></i></span></a></li>
                      <li><a href="#hero">關於我們<span class="indicator"><i class="fa fa-angle-right"></i></span></a></li>
                 
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          </nav>
          <section class="hero" id="hero">
            <div class="container">
              <div class="row">
                <div class="col-md-12 text-right navicon">
                  <a id="nav-toggle" class="nav_slide_button" href="#"><span></span></a>
                </div>
              </div>
              <div class="row">
                <div class="col-md-8 col-md-offset-2 text-center inner">
                  <h1 class="animated fadeInDown">回到過去 回憶中原</h1>
                  <h3 class="animated fadeInUp delay-05s">CYCU Find your memory</h3>
				  
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 col-md-offset-3 text-center">
                  <a href="#intro" class="learn-more-btn">Start</a>
                </div>
              </div>
            </div>
          </section>
        </header>
        <section class="intro text-center section-padding" id="intro">
          <div class="container">
            <div class="row">
              <div class="col-md-8 col-md-offset-2 wp1">
			  <h1><b>介紹</b></h1>
                <h1 class="arrow"></h1>
                <p>介紹想回味從前的大學時光嗎？
				想重返中原大學美麗的往昔景致嗎？
				快乘上這部時光機跟我們一起探索過去吧！
				本系統是中原大學60周年校慶特別活動
				可選擇中原老校園當背景照相
				於臉書分享出去即可參加抽獎唷！
				</p>
              </div>
            </div>
          </div>
        </section>
      
        <section class="swag text-center">
          <div class="container">
            <div class="row">
              <div class="col-md-8 col-md-offset-2">
			  <br>
                <h1>選張懷念的校園場景吧!<br></h1>
				<br>
                <a href="#responsive" class="down-arrow-btn"><i class="fa fa-chevron-down"></i></a>
              </div>
            </div>
          </div>
        </section>
        <section class="text-center" id="responsive">
          <div class="container-fluid nopadding responsive-services">
            <div class="wrapper">
              
              <div class="fluid-white"></div>
            </div>
            <div class="container designs">
              <div class="row">
                <div class="col-md-8 col-md-offset-2">
                  <div id="servicesSlider">
				  <br>
				  <br>
                    <ul class="slides">
                      <li>
                        <h1 class="arrow">中原大草皮</h1>
                   <div class="iphone">
                <div class="wp3"></div>
              </div>
                      </li>
                      <li>
                        <h1 class="arrow">中原教學大樓</h1>
                      
                      </li>
					  <li>
                        <h1 class="arrow">中原資館樓</h1>

                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
		  <a href="#abc" class="down-arrow-btn"><i class="fa fa-chevron-down"></i></a>
        </section>
        <section class="swag text-center" id = "abc">
          <div class="container">
            <div class="row">
              <div class="col-md-8 col-md-offset-2">
                 <h1>來拍照吧!<br><span>做出 <em>獨一無二</em> 的動作</span></h1>
                <a href="#portfolio" class="down-arrow-btn"><i class="fa fa-chevron-down"></i></a>
              </div>
            </div>
          </div>
        </section>
		
		
		<!-- 下面這個section就是拍攝照片的地方  -->
		
		
        <section class="portfolio text-center section-padding" id="portfolio">
          <div class="container">
            <div class="row">
              <div id="portfolioSlider">
                <div class="jumbotron">
    <!--介面開始-->
    <div id='interface'>
    </div>
    <!--介面結束-->
    <!--背景照選擇開始-->
    <div id='bgchose'>
    </div>
    <!--背景照選擇結束-->
    <!--拍照階段-->
        <h1>拍照囉～～</h1>
        <div class='select'>
            <label for='videoSource'>Video source:&nbsp;</label>
            <select id='videoSource'></select>
        </div>
        <div class="abox">
            <p>準備好後，請記得微笑！</p>

            <!--將表格傳送至=>php Server的url-->
            <form role="form" id="form1" action="/datastore" enctype="multipart/form-data" method="post">
              <!--拍照後data的存放地點-->
              <input type="hidden" name="custom_pic" id="custom_pic">
              <!--<input type="hidden" name="is_video" id="is_video" value="yes">-->
              <!--執行拍照-->
              <button type="button" class="btn btn-primary" id="screenshot-button">Take!</button>
              <input type="submit" class="btn btn-primary" value="確定" id="Oringinal">
              <button type="button" class="btn btn-primary" name="showvid-button"id="showvid-button">Again!</button>
            </form>  <br/>
            <div class="row">
              <div class="col-md-12" id='screen'>
                  <!--螢幕的即時呈現-->
                  <video id="videoscreen" style="width:95%;" autoplay></video>
                  <img id="screen-stream" src="" alt="" />
                  <!--拍照後圖片呈現-->
                  <img id="screenshot" style="width:95%;" src="">
                  <canvas id="screenshot-canvas"></canvas>
              </div>
            </div>
        </div>
        <!--拍照階段結束-->
        <!--合成圖片開始-->
        <div id='editor'>
        </div>
        <!--合成圖片結束-->
        <!--發布FaceBook-->
        <div id='publish'>
        </div>
        <!--發布FaceBook結束-->
    </div><!--end jumbotron-->
    <script>
      //控制按鈕的顯示方式
      $(document).ready(function(){
        $("#screenshot-button").click(function(){
          $("#videoscreen").hide();
          $("#screenshot").show();
        });
        $("#showvid-button").click(function(){
          $("#videoscreen").show();
          $("#screenshot").show();
        })
      });
      //Again!按鈕的執行函數
        $("#showvid-button").click(
          function(){
            $("#screenshot-button").prop("disabled",false);
          });
      //取得css設定
      var custom_pic = document.querySelector('#custom_pic');
      var videoElement = document.querySelector('#videoscreen');
      var button = document.querySelector('#screenshot-start-stop');
      var screenshot_button = document.querySelector('#screenshot-button');
      var canvas = document.querySelector('#screenshot-canvas');
      var img = document.querySelector('#screenshot');
      var ctx = canvas.getContext('2d');
      var localMediaStream = null;
      var videoSelect = document.querySelector("select#videoSource");

      //設定呈現大小
      function sizeCanvas() {
          // video.onloadedmetadata not firing in Chrome so we have to hack.
          // See crbug.com/110938.
          setTimeout(function() {
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            img.height = videoElement.offsetHeight;
            img.width = videoElement.offsetWidth;
          }, 1000);
      }

      //執行拍照的函數
      function snapshot() {
          console.log("in snapshot");
          var canvas = document.createElement('canvas');
          var ctx = canvas.getContext('2d');
          // make canvas size equal to the video source
          canvas.width = videoElement.videoWidth;
          canvas.height = videoElement.videoHeight;
          // for some reason img height is smaller than the video
          // but I think it's unrelated problem. this adjustment is
          // only for a visual aspect as the canvas data URL won't change.
          img.height = videoElement.offsetHeight;
          img.width = videoElement.offsetWidth;
          ctx.drawImage(videoElement, 0, 0);
          img.src = custom_pic.value = canvas.toDataURL('image/png');
      }

      //按下拍照鍵
      screenshot_button.addEventListener('click', function(e) {
          if (localMediaStream) {
            $(this).prop("disabled",true);
            $('#screen-stream').hide();
            $('#screenshot').show();
            snapshot();
            return;
          }
      }, false);

      //瀏覽器取得媒體方式
      navigator.getUserMedia = navigator.getUserMedia ||
        navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

      //鏡頭擷取
      function gotSources(sourceInfos) {
          for (var i = 0; i != sourceInfos.length; ++i) {
            var sourceInfo = sourceInfos[i];
            var option = document.createElement("option");
            option.value = sourceInfo.id;
            if (sourceInfo.kind === 'audio') {
            }
            else if (sourceInfo.kind === 'video') {
                option.text = sourceInfo.label || 'camera ' + (videoSelect.length + 1);
                videoSelect.appendChild(option);
            } else {
                console.log('Some other kind of source: ', sourceInfo);
            }
          }
      }

      if (typeof MediaStreamTrack === 'undefined'){
          alert('This browser does not support MediaStreamTrack.');
      } else {
          MediaStreamTrack.getSources(gotSources);
      }


      function successCallback(stream) {
          window.stream = stream; // make stream available to console
          videoElement.src = window.URL.createObjectURL(stream);
          localMediaStream = stream;
          sizeCanvas();
          videoElement.play();
      }

      //錯誤回傳
      function errorCallback(error){
          console.log("navigator.getUserMedia error: ", error);
      }

      //開始函數
      function start(){
          if (!!window.stream) {
            videoElement.src = null;
            window.stream.stop();
          }
          var videoSource = videoSelect.value;
          var constraints = {
            video: {
                optional: [{sourceId: videoSource}]
            }
          };
          navigator.getUserMedia(constraints, successCallback, errorCallback);
      }

      videoSelect.onchange = start;

      start();
    </script>
  </div> <!-- end container-->
              </div>
            </div>
          </div>
        </section>
     
       
       
        <footer>
          <div class="container">
            <div class="row">
              <div class="col-md-6 credit">
                <a>&copy;  如有問題，請洽中原大學資管系。Copyright@2015   </a> <a href="http://www.im.cycu.edu.tw/">   CYCUIM   </a>
              </div>
            </div>
          </div>
        </footer>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="js/jquery.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="js/waypoints.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/scripts.js"></script>
        <script src="js/jquery.flexslider.js"></script>
        <script src="js/modernizr.js"></script>
      </body>
    </html>